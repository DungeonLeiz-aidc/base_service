# üïí Migration Versions - B·∫£n ƒë·ªì Bi·∫øn ƒë·ªïi C·∫•u tr√∫c / Master Schema Evolution

**M·ª•c ƒë√≠ch / Purpose**: Danh m·ª•c n√†y l∆∞u gi·ªØ "Cu·ªën nh·∫≠t k√Ω" ghi l·∫°i to√†n b·ªô s·ª± ph√°t tri·ªÉn c·ªßa h·ªá th·ªëng d·ªØ li·ªáu d∆∞·ªõi d·∫°ng m·ªôt Danh s√°ch li√™n k·∫øt (Linked List). / This directory contains the historical journal of database evolution, structured as a specialized linked list.

Ti·∫øng Vi·ªát | [English](#-english-version)

---

## üáªüá≥ Ti·∫øng Vi·ªát

### üéØ Nhi·ªám v·ª• c·ªët l√µi (Core Responsibilities)
1. **Qu·∫£n l√Ω Th·ª© t·ª± Migration**: ƒê·∫£m b·∫£o c√°c thay ƒë·ªïi c·∫•u tr√∫c DB ƒë∆∞·ª£c th·ª±c hi·ªán ƒë√∫ng tr√¨nh t·ª±.
2. **Ghi nh·∫≠t k√Ω Tr·∫°ng th√°i**: L∆∞u gi·ªØ b·∫±ng ch·ª©ng v·ªÅ c√°c c·∫•u tr√∫c c≈© ƒë·ªÉ ƒë·ªëi chi·∫øu v√† ki·ªÉm tra.
3. **Duy tr√¨ C·∫•u tr√∫c Chu·ªói**: NgƒÉn ch·∫∑n database b·ªã sai l·ªách phi√™n b·∫£n qua h·ªá th·ªëng revision ID.
4. **ƒêi·ªÉm ki·ªÉm so√°t Audit**: Cung c·∫•p m√£ bƒÉm (Hash) ƒë·ªÉ x√°c minh t√≠nh ch√≠nh x√°c c·ªßa schema hi·ªán t·∫°i.
5. **C∆° ch·∫ø Kh√¥i ph·ª•c**: ƒê·ªãnh nghƒ©a h√†m `downgrade()` ƒë·ªÉ quay l·∫°i tr·∫°ng th√°i an to√†n khi c·∫ßn.

### üí° B·ªëi c·∫£nh & T∆∞ duy (Context & Why)
- **Context**: Database l√† th·ª© kh√≥ thay ƒë·ªïi nh·∫•t trong h·ªá th·ªëng. Vi·ªác qu·∫£n l√Ω c√°c b·∫£n c·∫≠p nh·∫≠t schema (migrations) gi√∫p ch√∫ng ta c√≥ kh·∫£ nƒÉng quay ng∆∞·ª£c th·ªùi gian n·∫øu c√≥ l·ªói x·∫£y ra.
- **Why Linked List?**: C·∫•u tr√∫c m·∫Øt x√≠ch (Revision -> Down Revision) ƒë·∫£m b·∫£o r·∫±ng b·∫•t k·ªÉ b·∫°n ƒëang ·ªü phi√™n b·∫£n n√†o, Alembic c≈©ng bi·∫øt ch√≠nh x√°c c√°c b∆∞·ªõc c·∫ßn l√†m ƒë·ªÉ n·∫°p t·ªõi phi√™n b·∫£n m·ªõi nh·∫•t.

### ‚ö†Ô∏è Quy tr√¨nh & R√†ng bu·ªôc (CCE Template)
- **Review Code**: Tuy·ªát ƒë·ªëi kh√¥ng ƒë∆∞·ª£c ch·∫°y migration khi ch∆∞a ƒë·ªçc k·ªπ code sinh ra.
- **Down Revision**: B·∫£n migration ƒë·∫ßu ti√™n ph·∫£i c√≥ `down_revision = None`.
- **Zero Modification**: Kh√¥ng s·ª≠a ƒë·ªïi n·ªôi dung file migration ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng v√†o m√¥i tr∆∞·ªùng th·∫≠t.

### üèõÔ∏è V√≠ d·ª• th·ª±c t·∫ø (Examples)
- **Kh·ªüi t·∫°o**: [001_initial_migration.py](file:///home/korosaki-ryukai/Workspace/Service/base_service/alembic/versions/001_initial_migration.py) t·∫°o c√°c b·∫£ng c∆° s·ªü.
- **V·∫≠n h√†nh**: S·ª≠ d·ª•ng `alembic current` ƒë·ªÉ xem phi√™n b·∫£n hi·ªán t·∫°i c·ªßa DB.

---

## üá∫üá∏ English Version

### üéØ Core Responsibilities
1. **Sequence Management**: Guarantees database structural changes follow a chronological order.
2. **Historical Journal**: Records every previous state of the schema for audit and verification.
3. **Integrity Maintenance**: Prevents version drift via a robust revision ID tracking system.
4. **Audit Checkpoint**: Uses Hash IDs to verify that the deployed schema matches the code source.
5. **Rollback Resilience**: Defines the `downgrade()` logic to safely revert schema updates.

### üí° Context & Why
- **Context**: Databases are the most rigid system component. Versioning schema changes allows us to "revert time" if a deployment introduces a critical failure.
- **Why Linked List?**: The chain structure (Revision -> Down Revision) ensures that from any point, Alembic calculates the exact delta needed to reach the target head.

### ‚ö†Ô∏è Process & Constraints (CCE Template)
- **Mandatory Review**: Never apply a migration before thoroughly auditing the autogenerated script.
- **The Origin**: The very first migration file must have `down_revision = None`.
- **Script Immutability**: CONTENT of a migration script must never be altered once applied to a live environment.

### üèõÔ∏è Practical Examples
- **Base State**: [001_initial_migration.py](file:///home/korosaki-ryukai/Workspace/Service/base_service/alembic/versions/001_initial_migration.py) initializing the core entities.
- **Verification**: Use `alembic current` to identify the active schema version of the database.
